<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Deepfake Detection</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>üîç Deepfake Detector</h1>
            </div>
            <div class="nav-links">
                <span id="user-name" class="user-name"></span>
                <a href="dashboard.html" class="active">Dashboard</a>
                <a href="upload.html">New Detection</a>
                <a href="history.html">History</a>
                <button onclick="logout()" class="btn btn-sm">Logout</button>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="container">
            <div class="dashboard-header">
                <h1>Welcome, <span id="welcome-user"></span>!</h1>
                <p>View your detection statistics and recent activity</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-info">
                        <h3 id="total-detections">0</h3>
                        <p>Total Detections</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-info">
                        <h3 id="real-count">0</h3>
                        <p>Real Content</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö†Ô∏è</div>
                    <div class="stat-info">
                        <h3 id="fake-count">0</h3>
                        <p>Fake Content</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-info">
                        <h3 id="avg-confidence">0%</h3>
                        <p>Avg Confidence</p>
                    </div>
                </div>
            </div>

            <div class="action-cards">
                <div class="action-card">
                    <h3>üñºÔ∏è Analyze Image</h3>
                    <p>Upload and detect deepfakes in images</p>
                    <a href="upload.html?type=image" class="btn btn-primary">Upload Image</a>
                </div>
                <div class="action-card">
                    <h3>üé• Analyze Video</h3>
                    <p>Upload and detect deepfakes in videos</p>
                    <a href="upload.html?type=video" class="btn btn-primary">Upload Video</a>
                </div>
            </div>

            <div class="recent-activity">
                <h2>Recent Detections</h2>
                <div id="recent-detections">
                    <div class="loading">Loading recent activity...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script>
        requireAuth();
        
        // Load user info
        const user = Storage.getUser();
        document.getElementById('user-name').textContent = user.full_name;
        document.getElementById('welcome-user').textContent = user.full_name;

        // Load statistics
        async function loadStats() {
            try {
                const data = await API.request(API_CONFIG.ENDPOINTS.USER_STATS);
                const stats = data.stats;

                document.getElementById('total-detections').textContent = stats.total_detections || 0;
                document.getElementById('real-count').textContent = stats.real_count || 0;
                document.getElementById('fake-count').textContent = stats.fake_count || 0;
                document.getElementById('avg-confidence').textContent = stats.avg_confidence ? 
                    Math.round(stats.avg_confidence) + '%' : '0%';
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Load recent detections
        async function loadRecentDetections() {
            try {
                const data = await API.request(API_CONFIG.ENDPOINTS.HISTORY + '?limit=5');
                const container = document.getElementById('recent-detections');
                
                if (data.history.length === 0) {
                    container.innerHTML = '<p class="empty-state">No detections yet. Start by uploading an image or video!</p>';
                    return;
                }

                container.innerHTML = data.history.map(detection => `
                    <div class="detection-item">
                        <div class="detection-icon">${detection.file_type === 'image' ? 'üñºÔ∏è' : 'üé•'}</div>
                        <div class="detection-info">
                            <h4>${detection.file_name}</h4>
                            <p>Result: <span class="result ${detection.result}">${detection.result.toUpperCase()}</span> 
                               ‚Ä¢ Confidence: ${detection.confidence}%</p>
                            <small>${new Date(detection.created_at).toLocaleString()}</small>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load recent detections:', error);
                document.getElementById('recent-detections').innerHTML = 
                    '<p class="error">Failed to load recent activity</p>';
            }
        }

        loadStats();
        loadRecentDetections();
    </script>
</body>
</html>